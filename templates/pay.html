<!-- templates/pay.html - Página de pago con Stripe -->
{% extends "base.html" %}
{% block content %}
<div class="max-w-md mx-auto card text-center">
    <h2 class="text-3xl font-bold mb-6 text-indigo-600"><i class="fas fa-credit-card mr-2"></i>Pagar Plan: {{ plan }}</h2>
    <p class="text-gray-600 mb-4">Ingresa los detalles de tu tarjeta para completar el pago.</p>
    <form action="{{ url_for('pay', plan=plan) }}" method="POST" id="payment-form">
        <div class="mb-4">
            <label class="block text-gray-700 font-semibold">Número de Tarjeta</label>
            <div id="card-element" class="p-3 border border-gray-300 rounded-lg"></div>
        </div>
        <button type="submit" class="btn-primary w-full"><i class="fas fa-credit-card mr-2"></i>Pagar</button>
    </form>
</div>
<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe('{{ key }}');
    const elements = stripe.elements();
    const cardElement = elements.create('card');
    cardElement.mount('#card-element');

    const form = document.getElementById('payment-form');
    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const {token, error} = await stripe.createToken(cardElement);
        if (error) {
            alert(error.message);
        } else {
            const hiddenInput = document.createElement('input');
            hiddenInput.setAttribute('type', 'hidden');
            hiddenInput.setAttribute('name', 'stripeToken');
            hiddenInput.setAttribute('value', token.id);
            form.appendChild(hiddenInput);
            form.submit();
        }
    });
</script>
{% endblock %}